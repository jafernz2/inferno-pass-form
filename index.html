<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inferno Schools Classroom and Hall System</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #form-container { display: none; margin-top: 20px; }
    .form-section { margin-bottom: 15px; }
    table, th, td { border: 1px solid black; border-collapse: collapse; }
    th, td { padding: 6px; }
  </style>
</head>
<body>

  <h1>Inferno Schools Classroom and Hall System</h1>

  <div class="form-section">
    <label for="access-code">Enter 4-digit Code:</label>
    <input type="text" id="access-code" maxlength="4">
    <button onclick="checkCode(7473)">Enter</button>
  </div>

  <div id="form-container">
    <div class="form-section">
      <label for="student-name">Student Name:</label>
      <select id="student-name"></select>
    </div>

    <div class="form-section">
      <label for="attendance-code">Attendance Code:</label>
      <select id="attendance-code">
        <option value="P">P - Present</option>
        <option value="T">T - Tardy</option>
        <option value="XT">XT - Excused Tardy</option>
        <option value="U">U - Unexcused Tardy</option>
        <option value="A">A - Absent</option>
        <option value="EA">EA - Excused Absence</option>
        <option value="OFC">OFC - Office Pass</option>
        <option value="NUR">NUR - Nurse</option>
        <option value="ISS">ISS - In-School Suspension</option>
        <option value="OSS">OSS - Out-of-School Suspension</option>
        <option value="EXT">EXT - Extra</option>
        <option value="ADM">ADM - Administrative Hold</option>
        <option value="HAL">HAL - Hallway Pass</option>
      </select>
    </div>

    <div class="form-section">
      <label for="pass-time">Pass Time:</label>
      <select id="pass-time">
        <option value="0">0 min - Mark change</option>
        <option value="3">3 min</option>
        <option value="5">5 min</option>
        <option value="10">10 min</option>
        <option value="15">15 min</option>
        <option value="20">20 min</option>
        <option value="25">25 min</option>
        <option value="30">30 min</option>
      </select>
    </div>

    <div class="form-section">
      <label for="room-number">Room Number:</label>
      <input type="text" id="room-number">
    </div>

    <div class="form-section">
      <label for="teacher-name">Teacher Last Name:</label>
      <input type="text" id="teacher-name">
    </div>

    <button onclick="handleSubmit()">Submit</button>

    <h3>Response Log</h3>
    <table id="response-log">
      <tr>
        <th>Student Name</th>
        <th>Pass Time</th>
        <th>Attendance</th>
        <th>Room</th>
        <th>Teacher</th>
      </tr>
    </table>
  </div>

  <script>
    const SHEET_ID = '1zrt4OA7rdiZaQjXpdSH_Jcs-7anJhp9OPeIa36iSf0s';
    const SHEET_RANGE = 'Sheet1!A2:A'; // assuming student names are in column A
    const API_KEY = 'AIzaSyCmNWPhC5h91xke_KFvl3HKcL-nUrTeleU'; // <-- Insert your own API key here

    function checkCode() {
      const code = document.getElementById('access-code').value;
      if (/^\\d{4}$/.test(code)) {
        document.getElementById('form-container').style.display = 'block';
        loadStudentNames();
      } else {
        alert('Invalid 4-digit code.');
      }
    }

    async function loadStudentNames() {
      const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_RANGE}?key=${API_KEY}`;
      try {
        const response = await fetch(url);
        const data = await response.json();
        const names = data.values ? data.values.flat() : [];
        const select = document.getElementById('student-name');
        select.innerHTML = '';
        names.forEach(name => {
          const option = document.createElement('option');
          option.textContent = name;
          select.appendChild(option);
        });
      } catch (err) {
        alert('Failed to load student names from Google Sheets.');
        console.error(err);
      }
    }

    function handleSubmit() {
      const name = document.getElementById('student-name').value;
      const passTime = document.getElementById('pass-time').value;
      const attendance = document.getElementById('attendance-code').value;
      const room = document.getElementById('room-number').value;
      const teacher = document.getElementById('teacher-name').value;

      // Log response
      const row = document.getElementById('response-log').insertRow();
      row.insertCell(0).textContent = name;
      row.insertCell(1).textContent = `${passTime} min`;
      row.insertCell(2).textContent = attendance;
      row.insertCell(3).textContent = room;
      row.insertCell(4).textContent = teacher;

      // Generate PDF
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(30);
      doc.text('PASS', 20, 30);
      doc.setFontSize(16);
      doc.text(`Student: ${name}`, 20, 50);
      doc.text(`Time: ${passTime} min`, 20, 60);
      doc.save(`${name}_pass.pdf`);
    }
  </script>
</body>
</html>
